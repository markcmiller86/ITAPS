.SILENT:
include @IMESH_DEFS@

PACKAGE_NAME=Swapping

ALL_INCLUDES=$(INCLUDES) $(IBASE_INCLUDES) $(IMESH_INCLUDES) -I.

OPTDebug = -O3 -DNDEBUG

CXX=@CXX@
CC=@CC@
CFLAGS=@CFLAGS@ $(OPTDebug)
CXXFLAGS=@CXXFLAGS@ $(OPTDebug)
CPPFLAGS=@CPPFLAGS@ $(ALL_INCLUDES)
# Yes, Virginia, make and autoconf disagree about the variable names.
FC=@F77@
F90=@FC@
FFLAGS=@FFLAGS@
F90FLAGS=@FCFLAGS@ $(OPTDebug)

LDFLAGS=@LDFLAGS@

.cc.o:
	echo Compiling $<
	$(CXX) $(CXXFLAGS) $(CPPFLAGS) $(EXTRA_INCLUDES) -c $<

.c.o:
	echo Compiling $<
	$(CC) $(CFLAGS) $(CPPFLAGS) $(EXTRA_INCLUDES) -c $<

.F90.o:
	echo Compiling $<
	$(F90) $(F90FLAGS) $(CPPFLAGS) $(EXTRA_INCLUDES) -c $<

.f90.o:
	echo Compiling $<
	$(F90) $(F90FLAGS) -c $<

.F.o:
	echo Compiling $<
	$(FC) $(FFLAGS) $(CPPFLAGS) $(EXTRA_INCLUDES) -c $<

.f.o:
	echo Compiling $<
	$(FC) $(FFLAGS) -c $<

STATIC_LIB=lib${PACKAGE_NAME}.a
SHARED_LIB=lib${PACKAGE_NAME}.so

INTERNAL_SRCS=ITAPS_Delaunay3D.cc \
ITAPS_InitCanon.cc \
ITAPS_MaxMinSine3D.cc \
ITAPS_MinMaxAngle3D.cc \
ITAPS_Swap2D.cc \
ITAPS_Swap3D.cc

INTERNAL_OBJS=ITAPS_Delaunay3D.o \
ITAPS_MaxMinSine3D.o \
ITAPS_MinMaxAngle3D.o \
ITAPS_Swap2D.o \
ITAPS_Swap3D.o

all: $(STATIC_LIB) $(SHARED_LIB)

objects: 
	echo Compiling server for $(PACKAGE_NAME)...
	make $(INTERNAL_OBJS)

$(STATIC_LIB): objects
	echo Creating static library for $(PACKAGE_NAME) server...
	@AR_STATIC@ $@ $(INTERNAL_OBJS)

$(SHARED_LIB): objects
	echo Creating shared library for $(PACKAGE_NAME) server...
	@AR_SHARED_CXX@ $@ $(INTERNAL_OBJS)

clean: 
	-rm -f *.o *~ swap3d_test

distclean: clean
	-rm -f Makefile ITAPS_Swap_config.hh $(STATIC_LIB) $(SHARED_LIB)
	-rm -f config.log config.status

INSTALL=@INSTALL@
  
install: @prefix@/lib @prefix@/include
	@INSTALL@ $(STATIC_LIB) $(SHARED_LIB) @prefix@/lib
	@INSTALL_DATA@ *.hh @prefix@/include

@prefix@/include/ITAPS:
	mkdir -p @prefix@/include/ITAPS

PWD=`pwd`
SWAP_DEPS=./libSwapping.so $(IMESH_FILES) $(IMESH_BACKEND_FILES)
SWAP_LIBS=-L$(PWD) -lSwapping -Wl,-rpath=$(PWD) $(IMESH_LIBS) $(IMESH_BACKEND_LIBS) 

# GNU-standard target for 'test'
check: test

test: all swap3d_test.o
	echo $(SWAP_LIBS)
	@CXX@ @LDFLAGS@ -o swap3d_test swap3d_test.o $(SWAP_LIBS)
	./swap3d_test rand1.vtk

depend:
	makedepend -Y. *.cc > /dev/null 2>1

